{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport * as FreeStyle from \"free-style\";\nimport * as helpers from \"style-helper\";\n\n/**\n * Re-export the `free-style` module.\n */\nexport { FreeStyle, helpers };\n\n/**\n * Tag the element for rendering later.\n */\nexport const STYLE_ID = \"__react_free_style__\";\n\n/**\n * Basic `noop` renderer. Used as the default context for testing.\n */\nexport class NoopRenderer {\n  merge(freeStyle: FreeStyle.FreeStyle) {\n    return; // Do nothing.\n  }\n\n  unmerge(freeStyle: FreeStyle.FreeStyle) {\n    return; // Do nothing.\n  }\n\n  toCss() {\n    return \"\";\n  }\n\n  toString() {\n    return `<style id=\"${STYLE_ID}\">${this.toCss()}</style>`;\n  }\n\n  toComponent() {\n    return React.createElement(\"style\", {\n      id: STYLE_ID,\n      dangerouslySetInnerHTML: { __html: this.toCss() }\n    });\n  }\n}\n\n/**\n * In-memory renderer. Used for server-side rendering.\n */\nexport class MemoryRenderer extends NoopRenderer {\n  freeStyle = FreeStyle.create();\n\n  merge(freeStyle: FreeStyle.FreeStyle) {\n    this.freeStyle.merge(freeStyle);\n  }\n\n  unmerge(freeStyle: FreeStyle.FreeStyle) {\n    this.freeStyle.unmerge(freeStyle);\n  }\n\n  toCss() {\n    return this.freeStyle.getStyles();\n  }\n}\n\n/**\n * DOM style sheet renderer. Used for front-end applications.\n */\nexport class StyleSheetRenderer extends MemoryRenderer {\n  constructor() {\n    super();\n\n    let element = document.getElementById(STYLE_ID) as HTMLStyleElement;\n    let styleSheet: CSSStyleSheet;\n\n    if (!element) {\n      element = document.createElement(\"style\");\n      element.setAttribute(\"id\", STYLE_ID);\n      element.setAttribute(\"type\", \"text/css\");\n      document.head.appendChild(element);\n    }\n\n    for (let i = 0; i < document.styleSheets.length; i++) {\n      const item = document.styleSheets.item(i)!;\n\n      if (item.ownerNode === element) {\n        styleSheet = item as CSSStyleSheet;\n        break;\n      }\n    }\n\n    this.freeStyle = FreeStyle.create(undefined, undefined, {\n      add(style, index) {\n        styleSheet.insertRule(style.getStyles(), index);\n      },\n      remove(style, index) {\n        styleSheet.deleteRule(index);\n      },\n      change(style, oldIndex, newIndex) {\n        styleSheet.deleteRule(oldIndex);\n        styleSheet.insertRule(style.getStyles(), newIndex);\n      }\n    });\n  }\n}\n\n/**\n * Export default React.js context object with `noop` behavior.\n */\nexport const Context = React.createContext<NoopRenderer>(new NoopRenderer());\n\n/**\n * Create a pre-computed `useStyles` hook for React.\n */\nexport function createStyles<T extends string>(\n  sheet: helpers.StyleSheet<T> = {} as helpers.StyleSheet<T>,\n  css?: helpers.StyleValue,\n  hash?: FreeStyle.HashFunction,\n  debug?: boolean\n) {\n  const Style = FreeStyle.create(hash, debug);\n  const styles = helpers.registerStyleSheet(Style, sheet, css);\n\n  return Object.assign(\n    function useStyles() {\n      useStyle(Style); // Automatically use \"own styles\".\n      return styles;\n    },\n    { styles }\n  );\n}\n\n/**\n * Dynamically register other `FreeStyle` instance.\n */\nexport function useStyle<T extends FreeStyle.FreeStyle>(Style: T): T {\n  const context = React.useContext(Context);\n\n  // Unmount styles automatically.\n  React.useEffect(() => () => context.unmerge(Style));\n\n  // Mount styles automatically.\n  context.merge(Style);\n\n  return Style;\n}\n\n/**\n * Type-safe styled component.\n */\nexport function styled<\n  T extends keyof JSX.IntrinsicElements &\n    (keyof HTMLElementTagNameMap | keyof SVGElementTagNameMap)\n>(type: T, style: helpers.StyleValue) {\n  const useStyle = createStyles({ style });\n\n  return Object.assign(\n    React.forwardRef(function Component(\n      props: JSX.IntrinsicElements[T],\n      ref: React.Ref<(HTMLElementTagNameMap & SVGElementTagNameMap)[T]> | null\n    ) {\n      const { style } = useStyle();\n      const className = props.className ? `${style} ${props.className}` : style;\n      return React.createElement(type, { ...props, ref, className });\n    }),\n    {\n      styles: useStyle.styles,\n      displayName: `Styled<${type}>`\n    }\n  );\n}\n"]}